var t,e;(t=self.document)&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":9999/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e));const n={ID:"token-action-hud-fu"},i={ID:"token-action-hud-core"},o="1.5",s={item:"tokenActionHud.fu.item",utility:"tokenActionHud.utility"},a={armor:{id:"armor",name:"tokenActionHud.fu.armor",type:"system"},equipment:{id:"equipment",name:"tokenActionHud.fu.equipment",type:"system"},consumables:{id:"consumables",name:"tokenActionHud.fu.consumables",type:"system"},containers:{id:"containers",name:"tokenActionHud.fu.containers",type:"system"},treasure:{id:"treasure",name:"tokenActionHud.fu.treasure",type:"system"},weapons:{id:"weapons",name:"tokenActionHud.fu.weapons",type:"system"},combat:{id:"combat",name:"tokenActionHud.combat",type:"system"},token:{id:"token",name:"tokenActionHud.token",type:"system"},utility:{id:"utility",name:"tokenActionHud.utility",type:"system"}},r={armor:{groupId:"armor"},backpack:{groupId:"containers"},consumable:{groupId:"consumables"},equipment:{groupId:"equipment"},treasure:{groupId:"treasure"},weapon:{groupId:"weapons"}};let c=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{c=class Utils{static getSetting(e,i=null){let o=i??null;try{o=game.settings.get(n.ID,e)}catch{t.api.Logger.debug(`Setting '${e}' not found`)}return o}static async setSetting(e,i){try{i=await game.settings.set(n.ID,e,i),t.api.Logger.debug(`Setting '${e}' set to '${i}'`)}catch{t.api.Logger.debug(`Setting '${e}' not found`)}}}}));let l=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{l=class ActionHandler extends t.api.ActionHandler{a;async buildSystemActions(t){this.actors=this.actor?[this.actor]:this._getActors(),this.actorType=this.actor?.type,this.displayUnequipped=c.getSetting("displayUnequipped"),this.actor,"character"===this.actorType?this.#t():"npc"===this.actorType?this.#e():this.actor||this.#n()}#t(){this.#i()}#e(){this.#i()}#n(){}async#i(){if(0===this.items.size)return;const e="item",n=new Map;for(const[t,e]of this.items){const i=e.type;if(e.equipped||this.displayUnequipped){const o=n.get(i)??new Map;o.set(t,e),n.set(i,o)}}for(const[i,o]of n){const n=r[i]?.groupId;if(!n)continue;const a={id:n,type:"system"},c=[...o].map((([n,i])=>{const o=n,a=i.name,r=t.api.Utils.i18n(s[e]),c=`${r?`${r}: `:""}${a}`,l=[e,o].join(this.delimiter);return{id:o,name:a,listName:c,encodedValue:l}}));this.addActions(c,a)}}}}));let d=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{const e=a;Object.values(e).forEach((e=>{e.name=t.api.Utils.i18n(e.name),e.listName=`Group: ${t.api.Utils.i18n(e.listName??e.name)}`}));const n=Object.values(e);d={layout:[{nestId:"inventory",id:"inventory",name:t.api.Utils.i18n("Template.Inventory"),groups:[{...e.weapons,nestId:"inventory_weapons"},{...e.armor,nestId:"inventory_armor"},{...e.equipment,nestId:"inventory_equipment"},{...e.consumables,nestId:"inventory_consumables"},{...e.containers,nestId:"inventory_containers"},{...e.treasure,nestId:"inventory_treasure"}]},{nestId:"utility",id:"utility",name:t.api.Utils.i18n("tokenActionHud.utility"),groups:[{...e.combat,nestId:"utility_combat"},{...e.token,nestId:"utility_token"},{...e.rests,nestId:"utility_rests"},{...e.utility,nestId:"utility_utility"}]}],groups:n}}));let u=null;function register(t){game.settings.register(n.ID,"displayUnequipped",{name:game.i18n.localize("tokenActionHud.fu.settings.displayUnequipped.name"),hint:game.i18n.localize("tokenActionHud.fu.settings.displayUnequipped.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}})}Hooks.once("tokenActionHudCoreApiReady",(async t=>{u=class RollHandler extends t.api.RollHandler{async handleActionClick(t,e){const[n,i]=e.split("|");if(["item"].includes(n)&&this.isRenderItem())return this.doRenderItem(this.actor,i);const o=["character"];if(this.actor)return void await this.#o(t,this.actor,this.token,n,i);const s=canvas.tokens.controlled.filter((t=>o.includes(t.actor?.type)));for(const e of s){const o=e.actor;await this.#o(t,o,e,n,i)}}async handleActionHover(t,e){}async handleGroupClick(t,e){}async#o(t,e,n,i,o){switch(i){case"item":this.#s(t,e,o);break;case"utility":this.#a(n,o)}}#s(t,e,n){e.items.get(n).toChat(t)}async#a(t,e){if("endTurn"===e)game.combat?.current?.tokenId===t.id&&await(game.combat?.nextTurn())}}}));let p=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{p=class SystemManager extends t.api.SystemManager{getActionHandler(){return new l}getAvailableRollHandlers(){return{core:"Core Template"}}getRollHandler(t){let e;return e=new u,e}async registerDefaults(){return d}registerSettings(t){register(t)}registerStyles(){return{template:{class:"tah-style-template-style",file:"tah-template-style",moduleId:n.ID,name:"Template Style"}}}}})),Hooks.on("tokenActionHudCoreApiReady",(async()=>{const t=game.modules.get(n.ID);t.api={requiredCoreModuleVersion:"1.5",SystemManager:p},Hooks.call("tokenActionHudSystemReady",t)}));export{s as ACTION_TYPE,l as ActionHandler,i as CORE_MODULE,d as DEFAULTS,a as GROUP,r as ITEM_TYPE,n as MODULE,o as REQUIRED_CORE_MODULE_VERSION,u as RollHandler,p as SystemManager,c as Utils,register};
