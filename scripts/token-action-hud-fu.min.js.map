{"version":3,"file":"token-action-hud-fu.min.js","sources":["constants.js","action-handler.js","defaults.js","roll-handler.js","settings.js","system-manager.js","init.js","utils.js"],"sourcesContent":["/**\n * Module-based constants\n */\nexport const MODULE = {\n    ID: 'token-action-hud-fu'\n}\n\n/**\n * Core module\n */\nexport const CORE_MODULE = {\n    ID: 'token-action-hud-core'\n}\n\n/**\n * Core module version required by the system module\n */\nexport const REQUIRED_CORE_MODULE_VERSION = '1.5'\n\n/**\n * Action types\n */\nexport const ACTION_TYPE = {\n    basic: 'TYPES.Ittem.basic',\n    weapon: 'TYPES.Item.weapon',\n    shield: 'TYPES.Item.shield',\n    armor: 'TYPES.Item.armor',\n    accessory: 'TYPES.Item.accessory',\n    consumable: 'TYPES.Item.consumable',\n    treasure: 'TYPES.Item.treasure',\n    class: 'TYPES.Item.class',\n    skill: 'TYPES.Item.skill',\n    heroic: 'TYPES.Item.heroic',\n    spell: 'TYPES.Item.spell',\n    miscAbility: 'TYPES.Item.miscAbility',\n    rule: 'TYPES.Item.rule',\n    behavior: 'TYPES.Item.behavior',\n    ritual: 'TYPES.Item.ritual',\n    project: 'TYPES.Item.project',\n    classFeature: 'TYPES.Item.classFeature',\n    optionalFeature: 'TYPES.Item.optionalFeature',\n    effect: 'TYPES.Item.effect',\n\n    action: 'FU.Action',\n    attack: 'FU.Attack',\n    equipment: 'FU.Equipment',\n    guard: 'FU.Guard',\n    inventory: 'FU.Inventory',\n    hinder: 'FU.Hinder',\n    objective: 'FU.Objective',\n    study: 'FU.Study',\n\n    check: 'tokenActionHud.fu.check.label',\n    travel: 'tokenActionHud.fu.check.travelcheck',\n    utility: 'tokenActionHud.utility'\n}\n\n/**\n * Groups\n */\nexport const GROUP = {\n\n    equipped: { id: 'equipped', name: 'tokenActionHud.fu.equipped.label', type: 'system' },\n    basic: { id: 'basic', name: 'TYPES.Item.basic', type: 'system' },\n    weapon: { id: 'weapon', name: 'TYPES.Item.weapon', type: 'system' },\n    shield: { id: 'shield', name: 'TYPES.Item.shield', type: 'system' },\n    armor: { id: 'armor', name: 'TYPES.Item.armor', type: 'system' },\n    accessory: { id: 'accessory', name: 'TYPES.Item.accessory', type: 'system' },\n    consumable: { id: 'consumable', name: 'TYPES.Item.consumable', type: 'system' },\n    treasure: { id: 'treasure', name: 'TYPES.Item.treasure', type: 'system' },\n    class: { id: 'class', name: 'TYPES.Item.class', type: 'system' },\n    skill: { id: 'skill', name: 'TYPES.Item.skill', type: 'system' },\n    heroic: { id: 'heroic', name: 'TYPES.Item.heroic', type: 'system' },\n    miscAbility: { id: 'miscAbility', name: 'TYPES.Item.miscAbility', type: 'system' },\n    rule: { id: 'rule', name: 'TYPES.Item.rule', type: 'system' },\n    behavior: { id: 'behavior', name: 'TYPES.Item.behavior', type: 'system' },\n    spell: { id: 'spell', name: 'TYPES.Item.spell', type: 'system' },\n    ritual: { id: 'ritual', name: 'TYPES.Item.ritual', type: 'system' },\n    project: { id: 'project', name: 'TYPES.Item.project', type: 'system' },\n    classFeature: { id: 'classFeature', name: 'TYPES.Item.classFeature', type: 'system' },\n    optionalFeature: { id: 'optionalFeature', name: 'TYPES.Item.optionalFeature', type: 'system' },\n    effect: { id: 'effect', name: 'TYPES.Item.effect', type: 'system' },\n\n    // Action Labels\n    check: { id: 'check', name: 'tokenActionHud.fu.check.label', type: 'system' },\n    action: { id: 'action', name: 'FU.Actions', type: 'system' },\n    attack: { id: 'attack', name: 'FU.attack', type: 'system' },\n    equipment: { id: 'equipment', name: 'FU.equipment', type: 'system' },\n    guard: { id: 'guard', name: 'FU.guard', type: 'system' },\n    inventory: { id: 'inventory', name: 'FU.inventory', type: 'system' },\n    hinder: { id: 'hinder', name: 'FU.hinder', type: 'system' },\n    objective: { id: 'objective', name: 'FU.objective', type: 'system' },\n    study: { id: 'study', name: 'FU.study', type: 'system' },\n\n    // Utility Labels\n    combat: { id: 'combat', name: 'tokenActionHud.combat', type: 'system' },\n    token: { id: 'token', name: 'tokenActionHud.token', type: 'system' },\n    utility: { id: 'utility', name: 'tokenActionHud.utility', type: 'system' }\n}\n\n/**\n * Item types\n */\nexport const ITEM_TYPE = {\n    basic: { groupId: 'basic' },\n    weapon: { groupId: 'weapon' },\n    shield: { groupId: 'shield' },\n    armor: { groupId: 'armor' },\n    accessory: { groupId: 'accessory' },\n    consumable: { groupId: 'consumable' },\n    treasure: { groupId: 'treasure' },\n    class: { groupId: 'class' },\n    skill: { groupId: 'skill' },\n    heroic: { groupId: 'heroic' },\n    miscAbility: { groupId: 'miscAbility' },\n    rule: { groupId: 'rule' },\n    spell: { groupId: 'spell' },\n    ritual: { groupId: 'ritual' },\n    project: { groupId: 'project' },\n    classFeature: { groupId: 'classFeature' },\n    optionalFeature: { groupId: 'optionalFeature' },\n    effect: { groupId: 'effect' }\n}\n","// System Module Imports\nimport { ACTION_TYPE, ITEM_TYPE } from './constants.js'\n\nexport let ActionHandler = null\n\nHooks.once('tokenActionHudCoreApiReady', async (coreModule) => {\n    /**\n     * Extends Token Action HUD Core's ActionHandler class and builds system-defined actions for the HUD\n     */\n    ActionHandler = class ActionHandler extends coreModule.api.ActionHandler {\n        /**\n         * Build system actions\n         * Called by Token Action HUD Core\n         * @override\n         * @param {array} groupIds\n         */\n        async buildSystemActions (groupIds) {\n            // Set actor and token variables\n            this.actors = (!this.actor) ? this._getActors() : [this.actor]\n            this.actorType = this.actor?.type\n\n            // Set items variable\n            if (this.actor) {\n                let items = this.actor.items\n                items = coreModule.api.Utils.sortItemsByName(items)\n                this.items = items\n            }\n\n            if (this.actorType === 'character') {\n                this.#buildCharacterActions()\n            } else if (this.actorType === 'npc') {\n                this.#buildNPCActions()\n            } else if (!this.actor) {\n                this.#buildMultipleTokenActions()\n            }\n        }\n\n        /**\n         * Build character actions\n         * @private\n         */\n        #buildCharacterActions () {\n            this.#buildCombatActions()\n            this.#buildItems()\n            this.#buildTravel()\n        }\n\n        /**\n         * Build npc actions\n         * @private\n         */\n        #buildNPCActions () {\n            this.#buildCombatActions()\n            this.#buildItems()\n            this.#buildTravel()\n        }\n\n        /**\n         * Build multiple token actions\n         * @private\n         * @returns {object}\n         */\n        #buildMultipleTokenActions () {\n        }\n\n        /**\n         * Build Combat Action actions for the HUD\n         *\n         * This method will create buttons for each combat action type.\n         * @private\n         */\n        async #buildCombatActions () {\n            const combatActions = [\n                { id: 'guardAction', name: 'Guard' },\n                { id: 'equipmentAction', name: 'Equipment' },\n                { id: 'hinderAction', name: 'Hinder' },\n                { id: 'inventoryAction', name: 'Inventory' },\n                { id: 'objectiveAction', name: 'Objective' },\n                { id: 'spellAction', name: 'Spell' },\n                { id: 'studyAction', name: 'Study' },\n                { id: 'skillAction', name: 'Skill' }\n            ]\n\n            const actionTypeId = 'action'\n            const combatGroupId = 'action' // Group ID for combat actions\n\n            const actions = combatActions.map(action => {\n                return {\n                    id: action.id,\n                    name: coreModule.api.Utils.i18n(action.name),\n                    listName: action.name,\n                    encodedValue: [actionTypeId, action.id].join(this.delimiter) // Ensure delimiter is defined\n                }\n            })\n\n            const combatGroupData = { id: combatGroupId, type: 'system' }\n            this.addActions(actions, combatGroupData)\n        }\n\n        /**\n         * Build Travel Action actions for the HUD\n         *\n         * This method handle the construction of action buttons for all combat actions.\n         *\n         * @private\n         */\n        async #buildTravel () {\n            const actionTypeId = 'action' // Action type identifier\n            const travelGroupId = 'check' // Group ID for the travel actions\n\n            // Define the travel action button\n            const travelAction = {\n                id: 'travelAction',\n                name: coreModule.api.Utils.i18n('Travel Check'), // Label for the action button\n                listName: 'Travel Check', // Tooltip or extended name\n                encodedValue: [actionTypeId, 'travelCheck'].join(this.delimiter) // Encoded value for the action\n            }\n\n            // Add the travel action to the \"Travel\" group\n            const travelGroupData = { id: travelGroupId, type: 'system' }\n            this.addActions([travelAction], travelGroupData)\n        }\n\n        /**\n         * Build Inventory Actions for the HUD, including equipped items.\n         * @private\n         *\n         * This method handle the construction of action buttons for items in the actor's\n         * inventory, organized by equipment slots.\n         */\n        async #buildItems () {\n            // Exit if the actor has no items\n            if (this.items.size === 0) return\n\n            const actionTypeId = 'item' // Action type identifier\n            const inventoryMap = new Map() // Map for categorized inventory items\n\n            // Equipment slots\n            const slots = ['mainHand', 'offHand', 'phantom', 'armor', 'accessory', 'arcanum']\n            const equippedItemIds = new Set() // Store equipped item IDs\n\n            // Gather equipped items from slots\n            for (const slot of slots) {\n                const equippedItemId = this.actor.system.equipped[slot]\n                if (equippedItemId) equippedItemIds.add(equippedItemId)\n            }\n\n            // Categorize items in the inventory\n            for (const [itemId, itemData] of this.items) {\n                const typeMap = inventoryMap.get(itemData.type) ?? new Map()\n                typeMap.set(itemId, itemData)\n                inventoryMap.set(itemData.type, typeMap)\n            }\n\n            // Create action buttons for each item type\n            for (const [type, typeMap] of inventoryMap) {\n                const groupId = ITEM_TYPE[type]?.groupId\n                if (!groupId) continue // Skip if no group ID\n\n                const groupData = { id: groupId, type: 'system' } // Group data for the item type\n\n                // Generate actions for items in this type\n                const actions = [...typeMap].map(([itemId, itemData]) => {\n                    const id = itemId\n                    const name = itemData.name\n                    const description = itemData.system.description || ''\n                    const actionTypeName = coreModule.api.Utils.i18n(ACTION_TYPE[actionTypeId])\n                    const listName = `${actionTypeName ? `${actionTypeName}: ` : ''}${name}<br>${description}`\n                    const encodedValue = [actionTypeId, id].join(this.delimiter)\n\n                    return {\n                        id,\n                        name,\n                        listName,\n                        encodedValue\n                    }\n                })\n\n                this.addActions(actions, groupData) // Add actions to the group\n            }\n\n            // Handle equipped items separately for the \"Equipped\" group\n            const equippedActions = [...this.items].filter(([itemId]) => equippedItemIds.has(itemId)).map(([itemId, itemData]) => {\n                const id = itemId\n                const name = itemData.name\n                const description = itemData.system.description || ''\n                const actionTypeName = coreModule.api.Utils.i18n(ACTION_TYPE[actionTypeId])\n                const listName = `${actionTypeName ? `${actionTypeName}: ` : ''}${name}<br>${description}`\n                const encodedValue = [actionTypeId, id].join(this.delimiter)\n\n                return {\n                    id,\n                    name,\n                    listName,\n                    encodedValue\n                }\n            })\n\n            // Add equipped actions to the \"Equipped\" group\n            const equippedGroupData = { id: 'equipped', type: 'system' }\n            this.addActions(equippedActions, equippedGroupData)\n        }\n    }\n})\n","import { GROUP } from './constants.js'\n\n/**\n * Default layout and groups\n */\nexport let DEFAULTS = null\n\nHooks.once('tokenActionHudCoreApiReady', async (coreModule) => {\n    const groups = GROUP\n    Object.values(groups).forEach((group) => {\n        group.name = coreModule.api.Utils.i18n(group.name)\n        group.listName = `${game.i18n.localize(\n            'tokenActionHud.fu.group'\n        )}: ${coreModule.api.Utils.i18n(group.listName ?? group.name)}`\n    })\n    const groupsArray = Object.values(groups)\n    DEFAULTS = {\n        layout: [\n            {\n                nestId: 'action',\n                id: 'action',\n                name: coreModule.api.Utils.i18n('Action'),\n                groups: [\n                    { ...groups.check, nestId: 'action_check' },\n                    { ...groups.action, nestId: 'action_action' }\n                ]\n            },\n            {\n                nestId: 'feature',\n                id: 'feature',\n                name: coreModule.api.Utils.i18n('Feature'),\n                groups: [\n                    { ...groups.basic, nestId: 'feature_basic' },\n                    { ...groups.spell, nestId: 'feature_spell' },\n                    { ...groups.miscAbility, nestId: 'feature_miscAbility' },\n                    { ...groups.rule, nestId: 'feature_rule' },\n                    { ...groups.ritual, nestId: 'feature_ritual' },\n                    { ...groups.project, nestId: 'feature_project' },\n                    { ...groups.classFeature, nestId: 'feature_classFeature' },\n                    { ...groups.optionalFeature, nestId: 'feature_optionalFeature' }\n                ]\n            },\n            {\n                nestId: 'item',\n                id: 'item',\n                name: coreModule.api.Utils.i18n('Items'),\n                groups: [\n                    { ...groups.equipped, nestId: 'item_equipped' },\n                    { ...groups.weapon, nestId: 'item_weapon' },\n                    { ...groups.shield, nestId: 'item_shield' },\n                    { ...groups.armor, nestId: 'item_armor' },\n                    { ...groups.accessory, nestId: 'item_accessory' },\n                    { ...groups.consumable, nestId: 'item_consumable' },\n                    { ...groups.treasure, nestId: 'item_treasure' }\n                ]\n            },\n            {\n                nestId: 'utility',\n                id: 'utility',\n                name: coreModule.api.Utils.i18n('tokenActionHud.utility'),\n                groups: [\n                    { ...groups.combat, nestId: 'utility_combat' },\n                    { ...groups.token, nestId: 'utility_token' },\n                    { ...groups.rests, nestId: 'utility_rests' },\n                    { ...groups.utility, nestId: 'utility_utility' }\n                ]\n            }\n        ],\n        groups: groupsArray\n    }\n})\n","export let RollHandler = null\n\nHooks.once('tokenActionHudCoreApiReady', async (coreModule) => {\n    /**\n     * Extends Token Action HUD Core's RollHandler class and handles action events triggered when an action is clicked\n     */\n    RollHandler = class RollHandler extends coreModule.api.RollHandler {\n        /**\n         * Handle action click\n         * Called by Token Action HUD Core when an action is left or right-clicked\n         * @override\n         * @param {object} event        The event\n         * @param {string} encodedValue The encoded value\n         */\n        async handleActionClick (event, encodedValue) {\n            const [actionTypeId, actionId] = encodedValue.split('|')\n\n            const isShift = this.shift\n\n            const renderable = ['item']\n\n            if (renderable.includes(actionTypeId) && this.isRenderItem()) {\n                return this.doRenderItem(this.actor, actionId)\n            }\n\n            const knownCharacters = ['character']\n\n            // If single actor is selected\n            if (this.actor) {\n                await this.#handleAction(event, this.actor, this.token, actionTypeId, actionId, isShift)\n                return\n            }\n\n            const controlledTokens = canvas.tokens.controlled\n                .filter((token) => knownCharacters.includes(token.actor?.type))\n\n            // If multiple actors are selected\n            for (const token of controlledTokens) {\n                const actor = token.actor\n                await this.#handleAction(event, actor, token, actionTypeId, actionId, isShift)\n            }\n        }\n\n        /**\n         * Handle action hover\n         * Called by Token Action HUD Core when an action is hovered on or off\n         * @override\n         * @param {object} event        The event\n         * @param {string} encodedValue The encoded value\n         */\n        async handleActionHover (event, encodedValue) {}\n\n        /**\n         * Handle group click\n         * Called by Token Action HUD Core when a group is right-clicked while the HUD is locked\n         * @override\n         * @param {object} event The event\n         * @param {object} group The group\n         */\n        async handleGroupClick (event, group) {}\n\n        /**\n         * Handle action\n         * @private\n         * @param {object} event        The event\n         * @param {object} actor        The actor\n         * @param {object} token        The token\n         * @param {string} actionTypeId The action type id\n         * @param {string} actionId     The actionId\n         */\n        async #handleAction (event, actor, token, actionTypeId, actionId, isShift) {\n            switch (actionTypeId) {\n            case 'item':\n                this.#handleItemAction(event, actor, actionId)\n                break\n            case 'action':\n                this.#handleCombatAction(event, actor, actionId, isShift)\n                break\n            case 'utility':\n                this.#handleUtilityAction(token, actionId)\n                break\n            }\n        }\n\n        /**\n         * Handles combat actions\n         *\n         * @private\n         * @param {Event} event     The event\n         * @param {Object} actor    The actor\n         * @param {string} actionId The action type id\n         * @param {boolean} isShift Whether Shift key was pressed\n         *\n         * @returns {Promise<void>}\n         */\n        async #handleCombatAction (event, actor, actionId, isShift) {\n            const combatActionHandler = new game.projectfu.ActionHandler(actor)\n\n            switch (actionId) {\n            case 'equipmentAction':\n                await combatActionHandler.handleAction('equipmentAction', isShift)\n                break\n            case 'guardAction':\n                await combatActionHandler.handleAction('guardAction', isShift)\n                break\n            case 'hinderAction':\n                await combatActionHandler.handleAction('hinderAction', isShift)\n                break\n            case 'inventoryAction':\n                await combatActionHandler.handleAction('inventoryAction', isShift)\n                break\n            case 'objectiveAction':\n                await combatActionHandler.handleAction('objectiveAction', isShift)\n                break\n            case 'spellAction':\n                await combatActionHandler.handleAction('spellAction', isShift)\n                break\n            case 'studyAction':\n                await combatActionHandler.handleAction('studyAction', isShift)\n                break\n            case 'skillAction':\n                await combatActionHandler.handleAction('skillAction', isShift)\n                break\n            case 'travelCheck':\n                game.lookfar.showTravelCheckDialog()\n                break\n            default:\n                console.warn(`Unknown action ID: ${actionId}`)\n                break\n            }\n        }\n\n        /**\n         * Handle item action\n         * @private\n         * @param {object} event    The event\n         * @param {object} actor    The actor\n         * @param {string} actionId The action id\n         */\n        #handleItemAction (event, actor, actionId) {\n            const item = actor.items.get(actionId)\n            item.roll()\n        }\n\n        /**\n         * Handle utility action\n         * @private\n         * @param {object} token    The token\n         * @param {string} actionId The action id\n         */\n        async #handleUtilityAction (token, actionId) {\n            switch (actionId) {\n            case 'endTurn':\n                if (game.combat?.current?.tokenId === token.id) {\n                    await game.combat?.nextTurn()\n                }\n                break\n            }\n        }\n    }\n})\n","// import { MODULE } from './constants.js'\n\n/**\n * Register module settings\n * Called by Token Action HUD Core to register Token Action HUD system module settings\n * @param {function} coreUpdate Token Action HUD Core update function\n */\nexport function register (coreUpdate) {\n    // game.settings.register(MODULE.ID, 'displayUnequipped', {\n    //     name: game.i18n.localize('tokenActionHud.fu.settings.displayUnequipped.name'),\n    //     hint: game.i18n.localize('tokenActionHud.fu.settings.displayUnequipped.hint'\n    //     ),\n    //     scope: 'client',\n    //     config: true,\n    //     type: Boolean,\n    //     default: true,\n    //     onChange: (value) => {\n    //         coreUpdate(value)\n    //     }\n    // })\n}\n","// System Module Imports\nimport { ActionHandler } from './action-handler.js'\nimport { RollHandler as Core } from './roll-handler.js'\nimport { MODULE } from './constants.js'\nimport { DEFAULTS } from './defaults.js'\nimport * as systemSettings from './settings.js'\n\nexport let SystemManager = null\n\nHooks.once('tokenActionHudCoreApiReady', async (coreModule) => {\n    /**\n     * Extends Token Action HUD Core's SystemManager class\n     */\n    SystemManager = class SystemManager extends coreModule.api.SystemManager {\n        /**\n         * Returns an instance of the ActionHandler to Token Action HUD Core\n         * Called by Token Action HUD Core\n         * @override\n         * @returns {class} The ActionHandler instance\n         */\n        getActionHandler () {\n            return new ActionHandler()\n        }\n\n        /**\n         * Returns a list of roll handlers to Token Action HUD Core\n         * Used to populate the Roll Handler module setting choices\n         * Called by Token Action HUD Core\n         * @override\n         * @returns {object} The available roll handlers\n         */\n        getAvailableRollHandlers () {\n            const coreTitle = 'Fabula Ultima'\n            const choices = { core: coreTitle }\n            return choices\n        }\n\n        /**\n         * Returns an instance of the RollHandler to Token Action HUD Core\n         * Called by Token Action HUD Core\n         * @override\n         * @param {string} rollHandlerId The roll handler ID\n         * @returns {class}              The RollHandler instance\n         */\n        getRollHandler (rollHandlerId) {\n            let rollHandler\n            switch (rollHandlerId) {\n            case 'core':\n            default:\n                rollHandler = new Core()\n                break\n            }\n            return rollHandler\n        }\n\n        /**\n         * Returns the default layout and groups to Token Action HUD Core\n         * Called by Token Action HUD Core\n         * @returns {object} The default layout and groups\n         */\n        async registerDefaults () {\n            return DEFAULTS\n        }\n\n        /**\n         * Register Token Action HUD system module settings\n         * Called by Token Action HUD Core\n         * @override\n         * @param {function} coreUpdate The Token Action HUD Core update function\n         */\n        registerSettings (coreUpdate) {\n            systemSettings.register(coreUpdate)\n        }\n\n        /**\n         * Returns styles to Token Action HUD Core\n         * Called by Token Action HUD Core\n         * @override\n         * @returns {object} The TAH system styles\n         */\n        registerStyles () {\n            return {\n                template: {\n                    class: 'tah-style-fu-style', // The class to add to first DIV element\n                    file: 'tah-fu-style', // The file without the css extension\n                    moduleId: MODULE.ID, // The module ID\n                    name: 'PFU Style' // The name to display in the Token Action HUD Core 'Style' module setting\n                }\n            }\n        }\n    }\n})\n","import { SystemManager } from './system-manager.js'\nimport { MODULE, REQUIRED_CORE_MODULE_VERSION } from './constants.js'\n\nHooks.on('tokenActionHudCoreApiReady', async () => {\n    /**\n     * Return the SystemManager and requiredCoreModuleVersion to Token Action HUD Core\n     */\n    const module = game.modules.get(MODULE.ID)\n    module.api = {\n        requiredCoreModuleVersion: REQUIRED_CORE_MODULE_VERSION,\n        SystemManager\n    }\n    Hooks.call('tokenActionHudSystemReady', module)\n})\n","import { MODULE } from './constants.js'\n\nexport let Utils = null\n\nHooks.once('tokenActionHudCoreApiReady', async (coreModule) => {\n    /**\n     * Utility functions\n     */\n    Utils = class Utils {\n        /**\n         * Get setting\n         * @param {string} key               The key\n         * @param {string=null} defaultValue The default value\n         * @returns {string}                 The setting value\n         */\n        static getSetting (key, defaultValue = null) {\n            let value = defaultValue ?? null\n            try {\n                value = game.settings.get(MODULE.ID, key)\n            } catch {\n                coreModule.api.Logger.debug(`Setting '${key}' not found`)\n            }\n            return value\n        }\n\n        /**\n         * Set setting\n         * @param {string} key   The key\n         * @param {string} value The value\n         */\n        static async setSetting (key, value) {\n            try {\n                value = await game.settings.set(MODULE.ID, key, value)\n                coreModule.api.Logger.debug(`Setting '${key}' set to '${value}'`)\n            } catch {\n                coreModule.api.Logger.debug(`Setting '${key}' not found`)\n            }\n        }\n    }\n})\n"],"names":["MODULE","ID","CORE_MODULE","REQUIRED_CORE_MODULE_VERSION","ACTION_TYPE","basic","weapon","shield","armor","accessory","consumable","treasure","class","skill","heroic","spell","miscAbility","rule","behavior","ritual","project","classFeature","optionalFeature","effect","action","attack","equipment","guard","inventory","hinder","objective","study","check","travel","utility","GROUP","equipped","id","name","type","combat","token","ITEM_TYPE","groupId","ActionHandler","Hooks","once","async","coreModule","api","groupIds","this","actors","actor","_getActors","actorType","items","Utils","sortItemsByName","buildCharacterActions","buildNPCActions","buildMultipleTokenActions","buildCombatActions","buildItems","buildTravel","actionTypeId","actions","map","i18n","listName","encodedValue","join","delimiter","combatGroupData","addActions","travelAction","travelGroupData","size","inventoryMap","Map","slots","equippedItemIds","Set","slot","equippedItemId","system","add","itemId","itemData","typeMap","get","set","groupData","description","actionTypeName","equippedActions","filter","has","DEFAULTS","groups","Object","values","forEach","group","game","localize","groupsArray","layout","nestId","rests","RollHandler","register","coreUpdate","event","actionId","split","isShift","shift","includes","isRenderItem","doRenderItem","knownCharacters","handleAction","controlledTokens","canvas","tokens","controlled","handleItemAction","handleCombatAction","handleUtilityAction","combatActionHandler","projectfu","lookfar","showTravelCheckDialog","console","warn","roll","current","tokenId","nextTurn","SystemManager","getActionHandler","getAvailableRollHandlers","core","getRollHandler","rollHandlerId","rollHandler","Core","registerSettings","registerStyles","template","file","moduleId","on","module","modules","requiredCoreModuleVersion","call","static","key","defaultValue","value","settings","Logger","debug"],"mappings":"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"}